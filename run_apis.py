import requests
import os
from configparser import ConfigParser
from concurrent import futures
import time


with open('config.properties') as f:
    config_lines = '[global]\n' + f.read()
f.close()

config = ConfigParser()
config.read_string(config_lines)

num_cores = int(config['global']['num_cores'])
num_models_per_server = int(config['global']['num_models_per_server'])

num_models = num_cores*num_models_per_server

COUNT = 100

url_template = "http://localhost:%i/predictions_neuron_core_%i/model_%i"

# Neuron Core 0
def api_nc_0_model_0(url_template, COUNT):
    start = time.time()
    

    for i in range(2):

        # API call
        prompt = "After Mom became sick, I viewed anything I had done as an insignificant, idle action to unburden myself with the task of school. I was no longer interested in what I wanted to achieve now that I was technically out in the “real world.” I moved back home to be on duty full time for my mom. Nothing else held importance except caring for the woman who had made my lunch every day.Through these unkind times, she never lost her passion for making jokes, laughing, and, most of all, food. She couldn’t eat more than a few bites at a time because of a stunted appetite and chemo-induced nausea, but she did make every bite count. More than ever, it became important that she baked cookies, banana bread, or a spur-of-the-moment batch of brownies from scratch when she had the energy to do it and the craving to eat what she made. Knife-full after knife-full of mayonnaise was applied to the turkey sandwiches she could stomach. But after a while, her wish to get better pushed aside her epicurean desires. She started changing her diet after reading about natural and holistic cancer-fighting remedies. She talked about whey protein and pomegranates and extolled the power of juicing. I remember checking her forehead for a fever because I had never heard such crazy talk come out of her mouth.About a year and a half after her diagnosis, she talked to her oncologist about having surrendered to eating healthier and cutting back on the rich foods she adored. He told her there was no reason why she couldn’t eat whatever she wanted. From what I understood about that simple conversation with her doctor—who was a man of very, very few words—it wasn’t that he was saying eating nutrient-packed foods wouldn’t or couldn’t do any good. It was that she should enjoy food and enjoy life as much as possible while she still could.After that, her lust for sinful, sumptuous foods and mayonnaise became wilder. If she had to go to Thomas Jefferson University Hospital in Philadelphia for a scan, we either went together afterwards or I went for her to pick up a corn beef special with extra-extra-extra Russian dressing from Hershel’s East Side Deli. The dressing had to be seeping from every crevice of the bread and fat-marbled meat. It was endearing to see this rail-thin woman smile at the sight of a giant sloppy sandwich. It was even more endearing to see her eat it—her first bite was always the biggest and she would let out a bliss-filled sigh while a third of the extra dressing she had requested draped and dripped down her chin.At times her insistence on more was embarrassing. Once we were at a diner and whatever she had ordered required her favorite condiment. She sent the waitress back multiple times to get more of the white stuff. I pleaded with Mom to be considerate since she used to be that waitress. I want more and why shouldn’t I get it? was all she said.And she was right. It made her feel alive to be able to eat what she wanted, however she wanted it. I was awe-struck by her recklessness. I wanted to be the kind of woman who attacked life the way my mom attacked her menu choices. She couldn’t control her health or the outcome of her marriage or even necessarily her compulsion to drink, but she could choose the way she ate. That’s how she lived the rest of her days, making the most out of what she could. Her body gave out far before her spirit. She couldn’t control her health or the outcome of her marriage or even necessarily her compulsion to drink, but she could choose the way she ate.It was a huge adjustment from being a young woman to being a young woman who had lost her mother. I had to figure out how to navigate everything without motherly guidance. I had to face the hard fact that our relationship, aside from her being my best friend, was a fairly codependent bond. Having become defined by my need to be needed by her, I was unsure of how to take care of myself. Purpose and direction were foreign languages. I was more fluent in being lost.I was left with this single question: what do I want out of life? Throughout the time I cared for my mom, I didn’t think I could handle the challenge of finding and starting a “real” job. Also, my prospects were something to be desired because of the job market and the tough economic times 2009 brought. I settled for waiting tables, just like Mom, to make money. The thoughtless monotony was welcomed. I could lose myself in the petty problems of an unhappy diner and take a break from thinking about how I was losing her a little bit more each day. Not much changed after she died: I continued to serve—just with a more somber demeanor.Is there a point to doing anything anymore if she isn’t around to be proud of me and to see the person I’m trying to become? That was always on my mind when I was half and heavy-heartedly trying to get it together. It was a small yearning that pushed me to join the rest of my friends and peers who were trying to or already were fulfilling their long-term goals and maybe even their dreams. But I was mostly jealous of them and ashamed of myself that I was playing catch-up. Inserted into the space of time when I should have been enjoying post-graduate life’s trails and tribulations and the rollercoaster of being a person in their twenties, I was dealing with situations that even most of my cousins, who were in their late-thirties or early forties, hadn’t gone through. My timeline played out in fast-forward, but after she died I had to switch gears and go through a regression of sorts—my twenty-something youth had been stripped from me and then given back. My timeline played out in fast-forward, but after she died I had to switch gears and go through a regression of sorts—my twenty-something youth had been stripped from me and then given back. I was depressed, enveloped in grief. Falling into that place of comfortable discomfort, my favorite kind of celebration became the pity party I threw myself at least once a day. I was paralyzed by a lack of confidence in my search for actual work that would utilize my talent and skills, which were of no use anymore since I hadn’t been actively using them. And besides that, I was on the lower end of my competition because I would be pooled with people who were fresher than me and had participated in opportunities I had to forego.I was locked into this mindset, and it cost me friends and strained the relationships I was able to maintain. No one wants to be standing under a dark cloud all the time, and I couldn’t blame them—I didn’t even want to be around me. That became my first sign. I knew something had to change.I can’t render it down to a specific moment, but eventually I did the brave thing and carried on. I kept faith that the weight of my past and present was building the future I wanted to come to fruition. Consciously, I made a promise to myself that there was a point to doing better for me, because Mom would want it that way. She always wanted better for me and believed so confidently I would obtain it.Weirdly enough, remembering my mom and the mayonnaise helped. Memories of how she found power in something as simple as her love for a particular condiment made me feel emboldened. I looked back at how she gracefully persevered through an unforgiving divorce, addiction, and cancer by enjoying what she loved without any apology. I knew I had to start living the same way. The place to begin was making myself mayonnaise saturated sandwiches. Growing up, mayonnaise was a tradition. My mom could have had sponsorship with Hellmann’s. The signature yellow and blue label and matching blue lid was never not in our refrigerator. As if in a shrine, the large jar was placed on the top shelf and was seemingly always full, ready to be consumed. Until I moved away for college, Mom made my lunch everyday to take to school. At times, it was a disappointment. I didn’t get to have pizza, chicken nuggets, or celebrate taco Tuesdays like most of my friends, but somehow even in elementary school, I knew how I should’ve appreciated it, even when I acted like I didn’t—there were occasional fits of pouting and whining after asking to buy lunch and not being allowed to. Before my parents divorced when I was nine, my mom was essentially a single parent. She was there for almost every moment and made sure she did all she could for me with very-little-to-no assistance. She chaperoned field trips and went to all my recitals and games, and, of course, made sure I had a homemade lunch for school—that was one of her top priorities. Lunch was always a sandwich. The deli meat and bread varied, but the one consistent feature was the coating of mayonnaise on the inside. Sometimes when I would go find her to say goodnight, she would be in the kitchen preparing my mid-day meal, standing over the counter scooping mayonnaise onto the bread and spreading it out in a sweeping, smooth motion with a knife. When I was a little older and wanted to return the favor of all those sandwich-making hours she had clocked in, I made sandwiches for her. This was met with some criticism though. For Mom, there was never enough mayonnaise. No matter how much was lacquered onto each slice of bread, there was no reason why a bit more couldn’t be added. Why are you being stingy? It won’t taste like anything if there isn’t enough. The condiment had to have a luxurious thickness for her to be satisfied. The constructed sandwich was simply the apparatus to deliver the tangy, unctuous emulsion to her mouth. The constructed sandwich was simply the apparatus to deliver the tangy, unctuous emulsion to her mouth. Moderation was never a practice in our household. My mom thought anything food-related should be enjoyed to its fullest extent. The only thing that came close to her love of mayo was her love of butter and anything chocolate, which was passed down to me. I was never denied anything when it came to food. Our pantry and fridge were stocked with real sugar and full-fat everything. Having sweets before dinner was completely acceptable too—as long as I asked politely first. When my parents separated and ultimately divorced, a lot came down on my mom. She struggled. My father, who had been predominantly an absentee figure in my childhood, became cruel and spiteful according to Mom—I don’t recall him always being that way, but that’s all I remember of him now. Even though he had moved out, he would come by the house and snoop around while she and I were gone. It was never confirmed but assumed he was breaking in to rearrange things on the dining room table or turn on the TV. These subtle domestic disturbances made my mom paranoid. If something went missing, it was your father. He was also very good at terrorizing her with more overt actions. “Anonymous” complaints were made to the township about the dangers of our rundown house. A neon orange notice tacked to our front door became a normal happening. Mom struggled to keep up with her responsibilities while working full-time as a waitress at our town’s country club. The lawn didn’t get mowed, leaves piled up everywhere, the gutters sagged and eventually broke away from the roof, the backyard pool transformed into an algae-infected swamp. The garbage and recycling cascaded over their respective bins because neither was brought to the curb often enough. My father chipped away at my mom, and the cracks of duress gave way to her falling apart. She indulged herself not with food but instead with drinking. My mayonnaise-saturated sandwiches were still made the night before school, but it was while she drank white wine from tall water glasses—the cheap kind sold in giant green glass handles. So many times, I found her passed out on the couch or in the bathroom. Her alcoholism was something that was never even acknowledged until I was in high school when she was hospitalized for complications related to it. She then knew that I understood what was happening for years. And besides witnessing it, my father would frequently bring up the subject as an attempt to make her look like the bad parent when I spent weekends with him. His smear campaign worked on me. I loved how my mom applied generosity to everything, but resented the application of it to drinking. Strangely though, she maintained an upbeat, spirited attitude. She knew she was being dragged through hell but didn’t let it show. The only telling sign was the unhealthy relationship she fostered with wine and, apparently, vodka. I found the biggest bottle of Popov I would ever see hidden next to the dryer. God only gives us what we can handle, she would say to me. We weren’t particularly religious, but she believed anything was manageable and was so sure that eventually our situation would open up to better times. Her projection was that good things were in her future and, especially, mine as I was entering the arena of young adulthood, young womanhood. She prayed and hoped I wouldn’t let anything—not even this undesirable, dark chapter—hold me back from the brightness she knew was ahead.I was far more skeptical and cynical. How strong does He think we are if He only gives us what we can handle? was my doubt-riddled rebuttal to Mom. As I traversed through high school during all of this, it was getting to be too much to handle. Harder and harder it became to imagine daily experiences that weren’t tinged with grey around the edges. The two of us fought. A lot. I held my mom in contempt for bringing this—my father’s despicable existence—upon us and upon me. I spread guilt and blame over her like a condiment. I began to believe that she was a loser, as Dad had put it so many times and in so many different iterations. While she still managed to take care of me in the same loving way as when I was a child, I could tell she cared less and less about how she took care of herself, and she didn’t see how that affected me. It became hard to respect a woman who was succumbing to the dirty, pathetic actions of a sorry excuse for a human being, my father. What kind of example was she setting for me? I could tell she cared less and less about how she took care of herself, and she didn’t see how that affected me.My mom died when I was 24. Mayonnaise wasn’t the cause. She was blessed with a body that naturally fought off gaining weight and, as far as I know, she wasn’t affected by the high blood pressure and cholesterol issues that ran in her family. It was a three-year feud with bile duct cancer that took her life. Throughout which, I cared for her. It was the second semester of my junior year in college when first she was diagnosed and then went through an attempt to surgically remove the tumor. After finding out the disease was inoperable, she then began chemotherapy. My senior year I barely fulfilled the requirements to graduate. Going back and forth between where Mom lived in southern New Jersey and where my school was in the northern part of the state was about a three-hour drive. I insisted on being with her most weekends and even during the week if things were particularly rough after treatment. Homework, projects, and papers fell to the wayside. In the end, I had a withdrawal, a couple incompletes, and three F’s on my final transcript, most of which occurred in my very last semester.By the summer of 2009, I was done with the distraction of school and could focus entirely on Mom. There was no euphoric feeling of achievement. It was just a relief to be finished. Anything that was once considered an accomplishment—like maintaining a high GPA and being asked to go to China as a student journalist to cover a university sponsored trip—was overshadowed.My senior year I barely fulfilled the requirements to graduate. Going back and forth between where Mom lived in southern New Jersey and where my school was in the northern part of the state was about a three-hour drive. I insisted on being with her most weekends and even during the week if things were particularly rough after treatment. Homework, projects, and papers fell to the wayside. In the end, I had a withdrawal, a couple incompletes, and three F’s on my final transcript, most of which occurred in my very last semester.By the summer of 2009, I was done with the distraction of school and could focus entirely on Mom. There was no euphoric feeling of achievement. It was just a relief to be finished. Anything that was once considered an accomplishment—like maintaining a high GPA and being asked to go to China as a student journalist to cover a university sponsored trip—was overshadowed.My senior year I barely fulfilled the requirements to graduate. Going back and forth between where Mom lived in southern New Jersey and where my school was in the northern part of the state was about a three-hour drive. I insisted on being with her most weekends and even during the week if things were particularly rough after treatment. Homework, projects, and papers fell to the wayside. In the end, I had a withdrawal, a couple incompletes, and three F’s on my final transcript, most of which occurred in my very last semester.By the summer of 2009, I was done with the distraction of school and could focus entirely on Mom. There was no euphoric feeling of achievement. It was just a relief to be finished. Anything that was once considered an accomplishment—like maintaining a high GPA and being asked to go to China as a student journalist to cover a university sponsored trip—was overshadowed.My senior year I barely fulfilled the requirements to graduate. Going back and forth between where Mom lived in southern New Jersey and where my school was in the northern part of the state was about a three-hour drive. I insisted on being with her most weekends and even during the week if things were particularly rough after treatment."
        response = requests.post(url_template % (8081,0,0),params={"prompt":prompt})

    total = time.time() - start
    print(total)

# Neuron Core 1
def api_nc_1_model_0(url_template, COUNT):
    start = time.time()
    for _ in range(COUNT):
        response = requests.get(url_template % (8082,1,0))
    total = time.time() - start
    print(total)

# Neuron Core 2
def api_nc_2_model_0(url_template, COUNT):
    for _ in range(COUNT):
        response = requests.get(url_template % (8083,2,0))

# Neuron Core 3
def api_nc_3_model_0(url_template, COUNT):
    for _ in range(COUNT):
        response = requests.get(url_template % (8084,3,0))

# Neuron Core 4
def api_nc_4_model_0(url_template, COUNT):
    for _ in range(COUNT):
        response = requests.get(url_template % (8085,4,0))

# Neuron Core 5
def api_nc_5_model_0(url_template, COUNT):
    for _ in range(COUNT):
        response = requests.get(url_template % (8086,5,0))



with futures.ThreadPoolExecutor(max_workers=num_cores) as executor:
    print("HI")
    executor.submit(api_nc_0_model_0,url_template, COUNT)
    # executor.submit(api_nc_1_model_0,url_template, COUNT)
    





